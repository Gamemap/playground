<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"/>

<div class="container">
  <h1>Log into Ariscu</h1>
  <form id="myForm" action="api.digilex.co.za/oauth/token" method="POST">
    <div class="form-group">
      <label for="email">Email address</label>
      <input type="email"
             class="form-control"
             id="email"
             placeholder="Enter email"
             name="email">
    </div>
    <div class="form-group">
      <label for="password">Password</label>
      <input type="password"
             class="form-control"
             id="password"
             placeholder="Password"
             name="password">
    </div>
    <button id="checkCreds" class="btn btn-primary">Submit</button>
  </form>
</div>

<script>
window.addEventListener('load', () => {
  function ariscuLogin () {
    const xhr = new XMLHttpRequest()

    const formData = new FormData(form)

    // Define what happens on successful data submission
    xhr.addEventListener("load", (event) => {
      const response = JSON.parse(event.target.responseText)

      debugger;

      // if (response.success === true) {
      //   loginSuccess()
      // } else {
      //   loginError()
      // }
    })

    // Define what happens in case of error
    xhr.addEventListener("error", loginError);

    // Set up our request
    xhr.open(form.method, form.action)

    // The data sent is what the user provided in the form
    xhr.send(formData)
  }

  function loginError () {
    alert('Username/email and password is incorrect!')
  }

  function loginSuccess () {
    window.location.assign('https://www.digilex.co.za/auth/redirect')
  }

  const form = document.getElementById('myForm')

  form.addEventListener('submit', (event) => {
    event.preventDefault()

    ariscuLogin()
  })
})
</script>
